<parameter name="content">/**
 * AcuTrace Analysis Page - Party Ledger & Fund Flow Intelligence
 * Enhanced with beautiful UI and smooth animations
 */

import React, { useState, useCallback } from "react"
import { useNavigate } from "react-router-dom"
import { 
  Upload, FileSpreadsheet, CheckCircle, ArrowRight, Sparkles, 
  Brain, GitBranch, Users, Target, Zap, Shield, Globe, RefreshCw
} from "lucide-react"

export default function AnalysisPage() {
  const navigate = useNavigate()
  const [files, setFiles] = useState([])
  const [isDragging, setIsDragging] = useState(false)
  const [isAnalyzing, setIsAnalyzing] = useState(false)
  const [progress, setProgress] = useState(0)
  const [progressStep, setProgressStep] = useState("")
  
  const steps = [
    { icon: Upload, label: "Upload XLS", desc: "Drag & drop bank statements" },
    { icon: Brain, label: "AI Party Detection", desc: "Extract parties from narration" },
    { icon: GitBranch, label: "Fund Flow Analysis", desc: "Build credit/debit chains" },
    { icon: Users, label: "Party Ledger", desc: "Generate complete ledger" }
  ]
  
  const features = [
    {
      icon: Target,
      title: "AI Party Detection",
      desc: "Automatically detect and cluster party names from transaction descriptions",
      color: "from-emerald-500 to-green-500"
    },
    {
      icon: GitBranch,
      title: "Fund Flow Chains",
      desc: "Trace money movement between parties with amount correlation",
      color: "from-purple-500 to-violet-500"
    },
    {
      icon: Users,
      title: "Party Ledger",
      desc: "Generate complete party-centric ledger with credit/debit totals",
      color: "from-blue-500 to-cyan-500"
    },
    {
      icon: Zap,
      title: "Instant Analysis",
      desc: "Process 2-20+ XLS files in seconds with parallel processing",
      color: "from-amber-500 to-orange-500"
    }
  ]
  
  const handleDragOver = useCallback(function(e) {
    e.preventDefault()
    setIsDragging(true)
  }, [])
  
  const handleDragLeave = useCallback(function(e) {
    e.preventDefault()
    setIsDragging(false)
  }, [])
  
  const handleDrop = useCallback(function(e) {
    e.preventDefault()
    setIsDragging(false)
    
    const droppedFiles = Array.from(e.dataTransfer.files).filter(
      function(file) { return file.name.endsWith('.xls') || file.name.endsWith('.xlsx') }
    )
    
    setFiles(function(prev) { return [...prev, ...droppedFiles].slice(0, 20) })
  }, [])
  
  const handleFileSelect = useCallback(function(e) {
    const selectedFiles = Array.from(e.target.files).filter(
      function(file) { return file.name.endsWith('.xls') || file.name.endsWith('.xlsx') }
    )
    
    setFiles(function(prev) { return [...prev, ...selectedFiles].slice(0, 20) })
  }, [])
  
  const removeFile = useCallback(function(index) {
    setFiles(function(prev) { return prev.filter(function(_, i) { return i !== index }) })
  }, [])
  
  const handleAnalyze = async function() {
    if (files.length === 0) return
    
    setIsAnalyzing(true)
    setProgress(0)
    
    const formData = new FormData()
    files.forEach(function(file) { formData.append("files", file) })
    
    try {
      setProgressStep("Uploading files...")
      setProgress(10)
      
      await new Promise(function(resolve) { setTimeout(resolve, 500) })
      
      setProgressStep("Extracting transactions...")
      setProgress(30)
      
      await new Promise(function(resolve) { setTimeout(resolve, 800) })
      
      setProgressStep("Detecting parties...")
      setProgress(50)
      
      await new Promise(function(resolve) { setTimeout(resolve, 800) })
      
      setProgressStep("Building fund flow chains...")
      setProgress(70)
      
      await new Promise(function(resolve) { setTimeout(resolve, 800) })
      
      setProgressStep("Generating party ledger...")
      setProgress(90)
      
      const response = await fetch("http://localhost:8000/api/analyze/multi", {
        method: "POST",
        body: formData
      })
      
      const data = await response.json()
      
      setProgress(100)
      setProgressStep("Complete!")
      
      await new Promise(function(resolve) { setTimeout(resolve, 500) })
      
      sessionStorage.setItem("analysisResults", JSON.stringify(data))
      navigate("/results")
      
    } catch (error) {
      console.error("Analysis failed:", error)
      alert("Analysis failed. Please check your backend server.")
    } finally {
      setIsAnalyzing(false)
      setProgress(0)
      setProgressStep("")
    }
  }
  
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
      {/* Header */}
      <header className="bg-slate-900/50 backdrop-blur-md border-b border-white/10 sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
          <button onClick={function() { navigate("/") }} className="text-2xl font-bold text-white flex items-center gap-2">
            <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-emerald-400 flex items-center justify-center shadow-lg shadow-emerald-500/25">
              <Target className="w-6 h-6 text-white" />
            </div>
            <span className="bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
              AcuTrace
            </span>
          </button>
          
          <div className="flex items-center gap-4">
            <span className="text-white/60 text-sm hidden sm:block">Party Ledger & Fund Flow Intelligence</span>
            <button 
              onClick={function() { navigate("/") }} 
              className="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-all"
            >
              Home
            </button>
          </div>
      </header>
      
      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-6 py-12">
        {/* Hero Section */}
        <div className="text-center mb-16">
          <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-green-500/10 border border-green-500/20 mb-6">
            <Sparkles className="w-4 h-4 text-green-400" />
            <span className="text-green-400 text-sm font-medium">AI-Powered Party Detection</span>
          </div>
          
          <h1 className="text-5xl md:text-6xl font-bold text-white mb-6 leading-tight">
            Party Ledger & <br />
            <span className="bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 bg-clip-text text-transparent">
              Fund Flow Intelligence
            </span>
          </h1>
          
          <p className="text-xl text-white/60 max-w-2xl mx-auto leading-relaxed">
            Upload your bank statement XLS files and let AI detect parties, 
            trace money flow, and generate comprehensive party ledger reports.
          </p>
        </div>
        
        {/* Upload Section */}
        <div className="max-w-3xl mx-auto mb-16">
          <div 
            onDragOver={handleDragOver}
            onDragLeave={handleDragLeave}
            onDrop={handleDrop}
            className={
              "relative overflow-hidden rounded-3xl transition-all duration-300 " +
              (isDragging 
                ? "bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-2 border-green-500/50" 
                : "bg-white/5 border-2 border-white/10 hover:border-white/20")
            }
          >
            {/* Animated gradient background */}
            <div className="absolute inset-0 bg-gradient-to-br from-green-500/5 via-transparent to-emerald-500/5" />
            
            <div className="relative p-10 text-center">
              <div className={
                "w-24 h-24 mx-auto rounded-2xl flex items-center justify-center mb-6 transition-all duration-300 " +
                (isDragging ? "bg-green-500/20 scale-110" : "bg-white/10")
              }>
                <FileSpreadsheet className={"w-12 h-12 transition-colors " + (isDragging ? "text-green-400" : "text-white/60")} />
              </div>
              
              <h2 className="text-2xl font-bold text-white mb-3">
                {isDragging ? "Drop files here" : "Upload XLS/XLSX Files"}
              </h2>
              
              <p className="text-white/60 mb-8">
                Drag & drop your bank statement files or click to browse
              </p>
              
              <div className="flex flex-wrap justify-center gap-3 mb-8">
                {['.xls', '.xlsx'].map(function(ext) {
                  return React.createElement("span", { key: ext, className: "px-3 py-1 rounded-lg bg-white/5 text-white/60 text-sm" }, ext)
                })}
              </div>
              
              <label className="inline-flex items-center gap-2 px-8 py-4 rounded-xl bg-gradient-to-r from-green-600 to-emerald-600 text-white font-semibold hover:from-green-500 hover:to-emerald-500 transition-all cursor-pointer shadow-lg shadow-emerald-500/25">
                <Upload className="w-5 h-5" />
                Choose Files
                <input 
                  type="file" 
                  multiple 
                  accept=".xls,.xlsx" 
                  onChange={handleFileSelect} 
                  className="hidden"
                />
              </label>
            </div>
            
            {/* Files list */}
            {files.length > 0 && React.createElement("div", { className: "relative px-10 pb-10" },
              React.createElement("div", { className: "flex flex-wrap gap-3" },
                files.map(function(file, index) {
                  return React.createElement("div", {
                    key: index,
                    className: "flex items-center gap-3 px-4 py-3 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15 transition-all group"
                  },
                    React.createElement(FileSpreadsheet, { className: "w-5 h-5 text-green-400" }),
                    React.createElement("span", { className: "text-white text-sm max-w-48 truncate" }, file.name),
                    React.createElement("button", {
                      onClick: function() { removeFile(index) },
                      className: "w-6 h-6 rounded-lg bg-white/10 hover:bg-red-500/20 hover:text-red-400 transition-all flex items-center justify-center"
                    }, "Ã—")
                  )
                })
              )
            )}
          </div>
          
          {/* Analyze Button */}
          {files.length > 0 && React.createElement("div", { className: "mt-8 text-center" },
            React.createElement("button", {
              onClick: handleAnalyze,
              disabled: isAnalyzing,
              className: {
                "inline-flex items-center gap-3 px-10 py-5 rounded-2xl font-bold text-xl transition-all duration-300": true,
                "bg-white/10 text-white/40 cursor-not-allowed": isAnalyzing,
                "bg-gradient-to-r from-green-600 to-emerald-600 text-white hover:from-green-500 hover:to-emerald-500 shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transform hover:scale-105": !isAnalyzing
              }
            },
              isAnalyzing ? React.createElement(React.Fragment, null,
                React.createElement(RefreshCw, { className: "w-6 h-6 animate-spin" }),
                "Analyzing..."
              ) : React.createElement(React.Fragment, null,
                React.createElement(Brain, { className: "w-6 h-6" }),
                "Analyze Statements",
                React.createElement(ArrowRight, { className: "w-6 h-6" })
              )
            ),
            React.createElement("p", { className: "text-white/40 text-sm mt-4" },
              files.length + " file" + (files.length !== 1 ? "s" : "") + " ready for analysis"
            )
          )}
          
          {/* Progress */}
          {isAnalyzing && React.createElement("div", { className: "mt-8 max-w-xl mx-auto" },
            React.createElement("div", { className: "flex items-center justify-between text-white/60 text-sm mb-3" },
              React.createElement("span", null, progressStep),
              React.createElement("span", null, progress + "%")
            ),
            React.createElement("div", { className: "h-2 bg-white/10 rounded-full overflow-hidden" },
              React.createElement("div", {
                className: "h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full transition-all duration-300",
                style: { width: progress + "%" }
              })
            )
          )}
        </div>
        
        {/* Steps */}
        <div className="mb-16">
          <h3 className="text-center text-white/60 text-sm uppercase tracking-wider mb-8">
            Analysis Process
          </h3>
          <div className="grid md:grid-cols-4 gap-4">
            {steps.map(function(step, index) {
              const Icon = step.icon
              return React.createElement("div", {
                key: index,
                className: "flex flex-col items-center text-center p-6 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all"
              },
                React.createElement("div", { className: "w-14 h-14 rounded-xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center mb-4" },
                  React.createElement(Icon, { className: "w-7 h-7 text-green-400" })
                ),
                React.createElement("h4", { className: "text-white font-semibold mb-1" }, step.label),
                React.createElement("p", { className: "text-white/40 text-sm" }, step.desc)
              )
            })}
          </div>
        
        {/* Features */}
        <div>
          <h3 className="text-center text-white/60 text-sm uppercase tracking-wider mb-8">
            Features
          </h3>
          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
            {features.map(function(feature, index) {
              const Icon = feature.icon
              return React.createElement("div", {
                key: index,
                className: "group p-6 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all hover:transform hover:-translate-y-1"
              },
                React.createElement("div", { className: "w-14 h-14 rounded-xl bg-gradient-to-br " + feature.color + " flex items-center justify-center mb-4 shadow-lg" },
                  React.createElement(Icon, { className: "w-7 h-7 text-white" })
                ),
                React.createElement("h4", { className: "text-white font-semibold mb-2" }, feature.title),
                React.createElement("p", { className: "text-white/40 text-sm" }, feature.desc)
              )
            })}
          </div>
      </main>
      
      {/* Footer */}
      <footer className="border-t border-white/10 mt-20">
        <div className="max-w-7xl mx-auto px-6 py-8">
          <div className="flex flex-col md:flex-row justify-between items-center gap-4">
            <div className="flex items-center gap-2 text-white/40">
              <Shield className="w-4 h-4" />
              <span>Secure Local Processing</span>
            </div>
            <div className="flex items-center gap-2 text-white/40">
              <Globe className="w-4 h-4" />
              <span>XLS/XLSX Only - No PDF Upload</span>
            </div>
            <div className="text-white/40">
              AcuTrace Party Ledger & Fund Flow Intelligence
            </div>
        </div>
      </footer>
    </div>
  )
}
</parameter>
